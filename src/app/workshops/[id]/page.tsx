"use client";
import { useEffect, useState } from "react";
import { useParams } from "next/navigation";
import { fetchWorkshopsById, Workshop } from "@/utility/workshop";
import { format } from "date-fns";
import Footer from "@/app/layouts/Footer";
import BackButton from "@/app/components/BackButton";
import ImageBanner from "@/app/components/ImageBanner";

const formatDate = (isoString: string | null): string => {
  if (!isoString) return "N/A";
  const date = new Date(isoString);
  return format(date, "EEEE dd MMMM yyyy");
};

const formatTime = (isoString: string | null): string => {
  if (!isoString) return "N/A";
  const date = new Date(isoString);
  return format(date, "HH:mm");
};

const WorkshopDetail = () => {
  const { id } = useParams();
  const [workshopDetail, setWorkshopDetail] = useState<Workshop | null>(null);
  const [loading, setLoading] = useState<boolean>(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    if (id) {
      const fetchData = async () => {
        try {
          const data = await fetchWorkshopsById(Number(id));
          setWorkshopDetail(data);
        } catch (error) {
          setError("Failed to fetch workshop details");
        } finally {
          setLoading(false);
        }
      };
      fetchData();
    }
  }, [id]);

  if (loading) return <p>Loading...</p>;
  if (error) return <p>{error}</p>;

  return (
    <div className="font-lexend text-[#4C4343] bg-[#FFF7EB] min-h-screen flex flex-col justify-between">
      <BackButton />

      <div className="flex flex-row justify-between">
        <div className=""></div>
        <div className="md:mt-[75px]">
          {workshopDetail ? (
            <div className=" font-lexend text-[#4C4343] flex flex-col md:flex-row flex-auto mt-[55px] p-4 md:bg-white rounded-xl">
              <div className="mt-[13px] ml-5">
                <h1 className=" mb-2 text-[25px]">{workshopDetail?.name}</h1>
                <p className="mb-2 text-[#4C4343] text-[14px] font-light block md:hidden">
                  &emsp;&emsp;{workshopDetail?.description}
                </p>
                <div className="sm:w-[350px] sm:h-[220px] md:w-[380px] md:h-[240px]">
                  {workshopDetail.photos?.length > 0 ? (
                    <div className="flex justify-center">
                      <div className="sm:w-[350px] sm:h-[250px] md:w-[380px] md:h-[300px]">
                        <ImageBanner
                          photos={workshopDetail.photos}
                          basePath="http://127.0.0.1:3000/"
                        />
                      </div>
                    </div>
                  ) : (
                    <div className="w-full h-[200px] bg-gray-300 flex items-center justify-center text-gray-600 rounded-[10px]">
                      No Image Available
                    </div>
                  )}
                </div>
              </div>
              <div className="mx-5  item-center justify-center md:mt-6">
                <div className="md:ml-14 ">
                  <p className="md:mt-11 mb-1 text-[#4C4343] text-[14px]  hidden md:block font-light">
                    &emsp;&emsp;{workshopDetail?.description}
                  </p>

                  <div className=" flex items-center mt-5 mb-2 text-[18px]"></div>
                  <p className="mb-2 text-[18px]"> Details</p>
                  <ul className="text-[14px] font-light">
                    <div className="flex">
                      <svg
                        width="14"
                        height="15"
                        viewBox="0 0 14 15"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          d="M12.625 1.25H10.9375V0.6875C10.9375 0.538316 10.8782 0.395242 10.7727 0.289752C10.6673 0.184263 10.5242 0.125 10.375 0.125C10.2258 0.125 10.0827 0.184263 9.97725 0.289752C9.87176 0.395242 9.8125 0.538316 9.8125 0.6875V1.25H4.1875V0.6875C4.1875 0.538316 4.12824 0.395242 4.02275 0.289752C3.91726 0.184263 3.77418 0.125 3.625 0.125C3.47582 0.125 3.33274 0.184263 3.22725 0.289752C3.12176 0.395242 3.0625 0.538316 3.0625 0.6875V1.25H1.375C1.07663 1.25 0.790483 1.36853 0.579505 1.5795C0.368526 1.79048 0.25 2.07663 0.25 2.375V13.625C0.25 13.9234 0.368526 14.2095 0.579505 14.4205C0.790483 14.6315 1.07663 14.75 1.375 14.75H12.625C12.9234 14.75 13.2095 14.6315 13.4205 14.4205C13.6315 14.2095 13.75 13.9234 13.75 13.625V2.375C13.75 2.07663 13.6315 1.79048 13.4205 1.5795C13.2095 1.36853 12.9234 1.25 12.625 1.25ZM3.0625 2.375V2.9375C3.0625 3.08668 3.12176 3.22976 3.22725 3.33525C3.33274 3.44074 3.47582 3.5 3.625 3.5C3.77418 3.5 3.91726 3.44074 4.02275 3.33525C4.12824 3.22976 4.1875 3.08668 4.1875 2.9375V2.375H9.8125V2.9375C9.8125 3.08668 9.87176 3.22976 9.97725 3.33525C10.0827 3.44074 10.2258 3.5 10.375 3.5C10.5242 3.5 10.6673 3.44074 10.7727 3.33525C10.8782 3.22976 10.9375 3.08668 10.9375 2.9375V2.375H12.625V4.625H1.375V2.375H3.0625ZM12.625 13.625H1.375V5.75H12.625V13.625ZM9.92922 7.60203C9.98152 7.65427 10.023 7.71631 10.0513 7.7846C10.0796 7.85288 10.0942 7.92608 10.0942 8C10.0942 8.07392 10.0796 8.14712 10.0513 8.2154C10.023 8.28369 9.98152 8.34573 9.92922 8.39797L6.55422 11.773C6.50198 11.8253 6.43994 11.8668 6.37165 11.8951C6.30337 11.9234 6.23017 11.9379 6.15625 11.9379C6.08233 11.9379 6.00913 11.9234 5.94085 11.8951C5.87256 11.8668 5.81052 11.8253 5.75828 11.773L4.07078 10.0855C3.96523 9.97992 3.90594 9.83677 3.90594 9.6875C3.90594 9.53823 3.96523 9.39508 4.07078 9.28953C4.17633 9.18398 4.31948 9.12469 4.46875 9.12469C4.61802 9.12469 4.76117 9.18398 4.86672 9.28953L6.15625 10.5798L9.13328 7.60203C9.18552 7.54973 9.24756 7.50824 9.31585 7.47994C9.38413 7.45163 9.45733 7.43706 9.53125 7.43706C9.60517 7.43706 9.67837 7.45163 9.74665 7.47994C9.81494 7.50824 9.87698 7.54973 9.92922 7.60203Z"
                          fill="#4C4343"
                        />
                      </svg>

                      <li>
                        &emsp;Date: {formatDate(workshopDetail?.date || "")}
                      </li>
                    </div>
                    <div className="flex">
                      <svg
                        width="18"
                        height="18"
                        viewBox="0 0 18 18"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          d="M9 1.6875C7.55373 1.6875 6.13993 2.11637 4.9374 2.91988C3.73486 3.72339 2.7976 4.86544 2.24413 6.20163C1.69067 7.53781 1.54586 9.00811 1.82801 10.4266C2.11017 11.8451 2.80661 13.148 3.82928 14.1707C4.85196 15.1934 6.15492 15.8898 7.57341 16.172C8.99189 16.4541 10.4622 16.3093 11.7984 15.7559C13.1346 15.2024 14.2766 14.2651 15.0801 13.0626C15.8836 11.8601 16.3125 10.4463 16.3125 9C16.3105 7.06123 15.5394 5.20246 14.1685 3.83154C12.7975 2.46063 10.9388 1.68955 9 1.6875ZM9 15.1875C7.77623 15.1875 6.57994 14.8246 5.56241 14.1447C4.54488 13.4648 3.75182 12.4985 3.2835 11.3679C2.81518 10.2372 2.69265 8.99314 2.93139 7.79288C3.17014 6.59262 3.75944 5.49011 4.62478 4.62478C5.49012 3.75944 6.59262 3.17014 7.79288 2.93139C8.99314 2.69264 10.2372 2.81518 11.3679 3.2835C12.4985 3.75181 13.4648 4.54488 14.1447 5.56241C14.8246 6.57994 15.1875 7.77623 15.1875 9C15.1856 10.6405 14.5331 12.2132 13.3732 13.3732C12.2132 14.5331 10.6405 15.1856 9 15.1875ZM13.5 9C13.5 9.14918 13.4407 9.29226 13.3353 9.39775C13.2298 9.50324 13.0867 9.5625 12.9375 9.5625H9C8.85082 9.5625 8.70775 9.50324 8.60226 9.39775C8.49677 9.29226 8.4375 9.14918 8.4375 9V5.0625C8.4375 4.91332 8.49677 4.77024 8.60226 4.66475C8.70775 4.55926 8.85082 4.5 9 4.5C9.14919 4.5 9.29226 4.55926 9.39775 4.66475C9.50324 4.77024 9.5625 4.91332 9.5625 5.0625V8.4375H12.9375C13.0867 8.4375 13.2298 8.49676 13.3353 8.60225C13.4407 8.70774 13.5 8.85082 13.5 9Z"
                          fill="#4C4343"
                        />
                      </svg>

                      <li>
                        &emsp;Time:{" "}
                        {formatTime(workshopDetail?.start_time || "")} -{" "}
                        {formatTime(workshopDetail?.end_time || "")}
                      </li>
                    </div>
                  </ul>

                  <div className=" flex items-center text-[14px] font-light">
                    <svg
                      width="18"
                      height="12"
                      viewBox="0 0 18 12"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M17.1731 1.21875C17.0921 1.16821 16.9996 1.13911 16.9043 1.13418C16.809 1.12926 16.714 1.14869 16.6282 1.19062C13.6097 2.66718 11.4539 1.97531 9.17508 1.24546C6.78445 0.479761 4.30594 -0.311255 0.881719 1.36078C0.786045 1.40667 0.705303 1.47869 0.648818 1.56852C0.592333 1.65835 0.562408 1.76232 0.5625 1.86843V10.301C0.562487 10.3965 0.586757 10.4903 0.633027 10.5738C0.679296 10.6573 0.746044 10.7276 0.826988 10.7782C0.907931 10.8287 1.00041 10.8579 1.09572 10.8628C1.19103 10.8678 1.28603 10.8484 1.3718 10.8066C4.39031 9.33 6.54609 10.0219 8.82844 10.7517C10.1813 11.1841 11.5594 11.625 13.1175 11.625C14.3191 11.625 15.6298 11.3634 17.119 10.6364C17.2136 10.5902 17.2933 10.5184 17.3491 10.4292C17.4049 10.3399 17.4346 10.2368 17.4347 10.1316V1.69898C17.4355 1.60329 17.412 1.50897 17.3662 1.42494C17.3204 1.3409 17.254 1.26994 17.1731 1.21875ZM16.3125 9.77367C13.4578 11.0512 11.373 10.3847 9.17156 9.68086C7.81875 9.24843 6.44063 8.80757 4.8825 8.80757C3.78781 8.81289 2.70425 9.02769 1.69031 9.44039V2.22632C4.545 0.948745 6.62977 1.61531 8.83125 2.31914C11.0327 3.02296 13.2989 3.75 16.3125 2.56101V9.77367ZM9 3.75C8.55499 3.75 8.11998 3.88196 7.74997 4.12919C7.37996 4.37642 7.09157 4.72782 6.92127 5.13896C6.75097 5.55009 6.70642 6.00249 6.79323 6.43895C6.88005 6.87541 7.09434 7.27632 7.40901 7.59099C7.72368 7.90565 8.12459 8.11995 8.56105 8.20676C8.99751 8.29358 9.4499 8.24902 9.86104 8.07873C10.2722 7.90843 10.6236 7.62004 10.8708 7.25003C11.118 6.88002 11.25 6.445 11.25 6C11.25 5.40326 11.0129 4.83096 10.591 4.40901C10.169 3.98705 9.59674 3.75 9 3.75ZM9 7.125C8.7775 7.125 8.55999 7.05902 8.37498 6.9354C8.18998 6.81178 8.04578 6.63608 7.96064 6.43052C7.87549 6.22495 7.85321 5.99875 7.89662 5.78052C7.94003 5.56229 8.04717 5.36184 8.20451 5.2045C8.36184 5.04717 8.5623 4.94002 8.78052 4.89661C8.99875 4.8532 9.22495 4.87548 9.43052 4.96063C9.63609 5.04578 9.81179 5.18997 9.9354 5.37498C10.059 5.55998 10.125 5.77749 10.125 6C10.125 6.29836 10.0065 6.58451 9.7955 6.79549C9.58452 7.00647 9.29837 7.125 9 7.125ZM3.9375 3.75V7.125C3.9375 7.27418 3.87824 7.41725 3.77275 7.52274C3.66726 7.62823 3.52418 7.6875 3.375 7.6875C3.22582 7.6875 3.08274 7.62823 2.97725 7.52274C2.87176 7.41725 2.8125 7.27418 2.8125 7.125V3.75C2.8125 3.60081 2.87176 3.45774 2.97725 3.35225C3.08274 3.24676 3.22582 3.1875 3.375 3.1875C3.52418 3.1875 3.66726 3.24676 3.77275 3.35225C3.87824 3.45774 3.9375 3.60081 3.9375 3.75ZM14.0625 8.25V4.875C14.0625 4.72581 14.1218 4.58274 14.2273 4.47725C14.3327 4.37176 14.4758 4.3125 14.625 4.3125C14.7742 4.3125 14.9173 4.37176 15.0227 4.47725C15.1282 4.58274 15.1875 4.72581 15.1875 4.875V8.25C15.1875 8.39918 15.1282 8.54226 15.0227 8.64774C14.9173 8.75323 14.7742 8.8125 14.625 8.8125C14.4758 8.8125 14.3327 8.75323 14.2273 8.64774C14.1218 8.54226 14.0625 8.39918 14.0625 8.25Z"
                        fill="#4C4343"
                      />
                    </svg>

                    <p>&emsp;Price</p>
                    <p className="text-[14px] font-light">
                      &emsp;{workshopDetail?.price} THB
                    </p>
                  </div>
                  <div className="flex">
                    <svg
                      width="16"
                      height="16"
                      viewBox="0 0 16 16"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M8 0.6875C6.55373 0.6875 5.13993 1.11637 3.9374 1.91988C2.73486 2.72339 1.7976 3.86544 1.24413 5.20163C0.690668 6.53781 0.545857 8.00811 0.828011 9.4266C1.11017 10.8451 1.80661 12.148 2.82928 13.1707C3.85196 14.1934 5.15492 14.8898 6.57341 15.172C7.99189 15.4541 9.46219 15.3093 10.7984 14.7559C12.1346 14.2024 13.2766 13.2651 14.0801 12.0626C14.8836 10.8601 15.3125 9.44628 15.3125 8C15.3103 6.06129 14.5391 4.20262 13.1683 2.83175C11.7974 1.46087 9.93871 0.689733 8 0.6875ZM14.1608 7.4375H11.3602C11.2344 4.87039 10.2458 3.05492 9.43508 1.98125C10.6939 2.28353 11.8265 2.97221 12.6741 3.95071C13.5217 4.92922 14.0418 6.14847 14.1615 7.4375H14.1608ZM5.76618 8.5625H10.2338C10.0714 11.4882 8.67078 13.2812 8 13.9766C7.32852 13.2805 5.9286 11.4875 5.76618 8.5625ZM5.76618 7.4375C5.9286 4.5118 7.32922 2.71883 8 2.02344C8.67149 2.72164 10.0714 4.51461 10.2338 7.4375H5.76618ZM6.56492 1.98125C5.75422 3.05492 4.76563 4.87039 4.63977 7.4375H1.83852C1.95819 6.14847 2.4783 4.92922 3.32591 3.95071C4.17353 2.97221 5.30614 2.28353 6.56492 1.98125ZM1.83852 8.5625H4.63977C4.76774 11.1296 5.75422 12.9451 6.56492 14.0188C5.30614 13.7165 4.17353 13.0278 3.32591 12.0493C2.4783 11.0708 1.95819 9.85153 1.83852 8.5625ZM9.43227 14.0188C10.243 12.9451 11.2295 11.1296 11.3574 8.5625H14.1587C14.0392 9.85116 13.5195 11.0701 12.6724 12.0486C11.8253 13.0271 10.6933 13.716 9.43508 14.0188H9.43227Z"
                        fill="#4C4343"
                      />
                    </svg>
                    <p className="text-[14px] font-light">
                      &emsp;Language: {workshopDetail?.language || "N/A"}
                    </p>
                  </div>
                  <div className="flex">
                    <svg
                      width="16"
                      height="15"
                      viewBox="0 0 16 15"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M15.2365 13.9062C14.1657 12.0549 12.5154 10.7274 10.5896 10.0981C11.5422 9.53102 12.2823 8.66689 12.6963 7.63844C13.1103 6.60999 13.1752 5.47409 12.8811 4.40516C12.587 3.33624 11.9502 2.39341 11.0684 1.72145C10.1866 1.0495 9.10862 0.685577 7.99998 0.685577C6.89134 0.685577 5.81335 1.0495 4.93156 1.72145C4.04976 2.39341 3.41293 3.33624 3.11884 4.40516C2.82476 5.47409 2.88968 6.60999 3.30366 7.63844C3.71763 8.66689 4.45775 9.53102 5.41037 10.0981C3.48451 10.7267 1.83427 12.0542 0.763414 13.9062C0.724144 13.9703 0.698096 14.0415 0.686808 14.1158C0.67552 14.19 0.679219 14.2658 0.697689 14.3386C0.716159 14.4114 0.749024 14.4798 0.794346 14.5397C0.839668 14.5996 0.896528 14.6498 0.961572 14.6874C1.02662 14.725 1.09853 14.7491 1.17306 14.7585C1.24759 14.7678 1.32324 14.7621 1.39554 14.7417C1.46784 14.7213 1.53532 14.6867 1.59401 14.6398C1.65269 14.5929 1.7014 14.5348 1.73724 14.4687C3.06193 12.1794 5.40334 10.8125 7.99998 10.8125C10.5966 10.8125 12.938 12.1794 14.2627 14.4687C14.2986 14.5348 14.3473 14.5929 14.4059 14.6398C14.4646 14.6867 14.5321 14.7213 14.6044 14.7417C14.6767 14.7621 14.7524 14.7678 14.8269 14.7585C14.9014 14.7491 14.9733 14.725 15.0384 14.6874C15.1034 14.6498 15.1603 14.5996 15.2056 14.5397C15.2509 14.4798 15.2838 14.4114 15.3023 14.3386C15.3207 14.2658 15.3244 14.19 15.3131 14.1158C15.3019 14.0415 15.2758 13.9703 15.2365 13.9062ZM4.06248 5.74999C4.06248 4.97123 4.29341 4.20995 4.72607 3.56243C5.15872 2.91491 5.77368 2.41023 6.49316 2.11221C7.21264 1.81419 8.00435 1.73622 8.76815 1.88815C9.53195 2.04008 10.2335 2.41509 10.7842 2.96576C11.3349 3.51643 11.7099 4.21802 11.8618 4.98182C12.0137 5.74562 11.9358 6.53732 11.6378 7.25681C11.3397 7.97629 10.8351 8.59125 10.1875 9.0239C9.54002 9.45656 8.77874 9.68749 7.99998 9.68749C6.95603 9.68637 5.95516 9.27117 5.21698 8.53299C4.47879 7.79481 4.06359 6.79394 4.06248 5.74999Z"
                        fill="#4C4343"
                      />
                    </svg>

                    <p className="text-[14px] font-light">
                      &emsp;Instructor: {workshopDetail?.instructor || "N/A"}
                    </p>
                  </div>
                </div>
              </div>
            </div>
          ) : (
            <p> No shop details found</p>
          )}
        </div>
        <div className=""></div>
      </div>
      <div className="flex flex-col justify-end mt-8">
        <div>
          <Footer />
        </div>
      </div>
    </div>
  );
};

export default WorkshopDetail;
